#!/bin/bash

if [[ "$1" == "-h" || "$1" == "--help" ]]; then cat <<HELP
Serve a file (or the current directory)
http://benalman.com/

Usage: `basename "$0"` [PORT] [FILE]

If a port isn't specified, use 8080. If a file isn't specified, serve the
current directory. Once started, open the specified file (or the current
directory) with the default web browser.

Copyright (c) 2011 "Cowboy" Ben Alman
Licensed under the MIT license.
http://benalman.com/about/license/
HELP
exit; fi

# Get port and file (if specified).
port=8080; if [[ "$1" =~ ^[0-9]+$ ]]; then port=$1; shift; fi
file=$1

# If not in an SSH session, open the URL in the default handler.
[[ "$SSH_TTY" ]] || ( { open "http://localhost:$port/$file"; } & )

# Doing this instead of -m SimpleHTTPServer allows you to redefine the default
# content type to something less annoying than application/octet-stream.
python=$(cat <<'PYTHON'
import SimpleHTTPServer
SimpleHTTPServer.SimpleHTTPRequestHandler.extensions_map[""] = "text/plain"
SimpleHTTPServer.test()
PYTHON
)
# Start web server.
python -c "$python" $port
